<!DOCTYPE html [<!ENTITY times '&#215;'>]>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:bootstrap="http://xmlns.jcp.org/jsf/composite/components/bootstrap"
      xmlns:libreccm="http://xmlns.jcp.org/jsf/composite/components/libreccm"
      xmlns:librecms="http://xmlns.jcp.org/jsf/composite/components/librecms"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:composition template="/WEB-INF/views/org/librecms/ui/contentsection/documents/authoringstep.xhtml">

        <ui:define name="authoringStep">
            <template id="cms-sort-attachments-error-general">
                <div class="alert alert-danger mt-3" role="alert">
                    #{CmsDefaultStepsMessageBundle['relatedinfo.sortattachments.errors.general']}
                </div>
            </template>
            <template id="cms-sort-attachments-error-save">
                <div class="alert alert-danger mt-3" role="alert">
                    #{CmsDefaultStepsMessageBundle['relatedinfo.sortattachments.errors.save']}
                </div>
            </template>
            <div class="text-right">
                <button class="btn btn-primary"
                        data-toggle="modal"
                        data-target="#add-attachment-list-dialog"
                        type="button">
                    <bootstrap:svgIcon icon="plus-circle" />
                    <span>#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.button.label']}</span>
                </button>
            </div>
            <div aria-hidden="true" 
                 aria-labelledby="add-attachment-list-dialog-title"
                 class="modal fade"
                 id="add-attachment-list-dialog"
                 tabindex="-1">
                <div class="modal-dialog">
                    <form action="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/@add"
                          class="modal-content"
                          method="post">
                        <div class="modal-header">
                            <h3 class="modal-title"
                                id="add-attachment-list-dialog-title">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.title']}</h3>
                            <button aria-label="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.close']}"
                                    class="close" 
                                    data-dismiss="modal"
                                    type="button">
                                <bootstrap:svgIcon icon="x-circle" />
                            </button>
                        </div>
                        <div class="modal-body">
                            <bootstrap:formGroupText 
                                help="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.name.help']}" 
                                inputId="#add-attachment-list-name"
                                label="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.name.label']}"
                                name="listName"
                                pattern="[A-Za-z0-9\-_]*"
                                required="true"
                                />
                            <bootstrap:formGroupText 
                                help="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.title.help']}" 
                                inputId="#add-attachment-list-title"
                                label="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.title.label']}"
                                name="listTitle"
                                />

                            <bootstrap:formGroupTextarea 
                                help="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.description.help']}" 
                                inputId="#add-attachment-list-name"
                                label="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.description.label']}"
                                name="listDescription"
                                />
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-warning"
                                    data-dismiss="modal"
                                    type="button">
                                #{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.close']}
                            </button>
                            <button class="btn btn-success"
                                    type="submit">
                                #{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.add.dialog.add_list']}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div>
                <button class="btn btn-secondary attachments-save-order-button"
                        disabled="disabled"
                        type="button">
                    <span class="save-icon">
                        <bootstrap:svgIcon icon="save" />
                    </span>
                    <span class="save-spinner d-none">
                        <span aria-hidden="true"
                              class="spinner-border spinner-border-sm"
                              role="status"></span>
                        <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.order.save.inprogress']}</span>
                    </span>
                    <span>#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.order.save']}</span>
                </button>
            </div>
            <div id="messages"></div>
            <ul class="cms-attachment-lists mt-3 list-group"
                data-baseUrl="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo-service/save-order">
                <c:forEach items="#{CmsRelatedInfoStep.attachmentLists}"
                           var="list">
                    <li class="cms-attachment-list mb-3 list-group-item list-group-item-primary"
                        data-id="#{list.uuid}">
                        <div class="d-flex justify-content-between">
                            <div>#{list.name}</div>
                            <div class="cms-attachmentlist-buttons d-flex">
                                <button class="btn btn-secondary cms-sort-handle mr-2"
                                        type="button">
                                    <bootstrap:svgIcon icon="arrows-move" />
                                    <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.move.button']}"</span>
                                </button>
                                <button class="btn btn-secondary mx-2"
                                        data-toggle="modal"
                                        data-target="#attachment-list-#{list.name}-info"
                                        type="button">
                                    <bootstrap:svgIcon icon="info-circle" />
                                    <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.info.button']}"</span>
                                </button>
                                <div aria-hidden="true"
                                     aria-labelledby="attachmentlist-#{list.name}-info-title"
                                     class="modal fade"
                                     id="attachment-list-#{list.name}-info"
                                     tabindex="-1">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h3 class="modal-title"
                                                    id="attachmentlist-#{list.name}-info-title">
                                                    #{CmsDefaultStepsMessageBundle.getMessage('relatedinfo.attachmentlists.info.dialog.title', [list.name])}
                                                </h3>
                                                <button 
                                                    aria-label="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.info.dialog.close']}"
                                                    class="close"
                                                    data-dismiss="modal"
                                                    type="button">
                                                    <bootstrap:svgIcon icon="x" />
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <dl>
                                                    <dt>#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.info.dialog.title.label']}</dt>
                                                    <dd>#{list.title}</dd>
                                                    <dt>#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.info.dialog.description.label']}</dt>
                                                    <dd>#{list.description}</dd>
                                                </dl>
                                            </div>
                                            <div class="modal-footer">
                                                <button class="btn btn-secondary"
                                                        data-dismiss="modal"
                                                        type="button">
                                                    #{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.info.dialog.close']}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <a class="btn btn-primary  mx-2"
                                   href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/#{list.name}/@details">
                                    <bootstrap:svgIcon icon="pen" />
                                    <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.edit.button']}"</span>
                                </a>
                                <librecms:assetPickerButton 
                                    assetPickerId="attach-file-picker-#{list.uuid}" 
                                    buttonIcon="file-earmark-plus"
                                    buttonText="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.attachment.add.label']}"
                                    />
                                <a class="btn btn-primary  mx-2"
                                   href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/#{list.name}/links/@create"
                                   type="button">
                                    <bootstrap:svgIcon icon="bookmark-plus" />
                                    <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.link.add.label']}</span>
                                </a>
                                <libreccm:deleteDialog 
                                    actionTarget="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/#{list.name}/@remove"
                                    buttonLabelClass="sr-only"
                                    buttonText="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.remove.label']}"
                                    buttonTextClass="ml-2"
                                    cancelLabel="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.remove.cancel']}"
                                    confirmLabel="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.remove.confirm']}"
                                    dialogId="attachmentlist-delete-#{list.uuid}"
                                    dialogTitle="#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.remove.title']}"
                                    message="#{CmsDefaultStepsMessageBundle.getMessage('relatedinfo.attachmentlists.remove.message', [list.name])}"
                                    />
                                <librecms:assetPicker 
                                    actionUrl="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/#{list.name}/attachments/@create"
                                    assetType="#{CmsRelatedInfoStep.fileAssetType}"
                                    assetPickerId="attach-file-picker-#{list.uuid}"
                                    baseUrl="#{CmsRelatedInfoStep.fileAssetPickerBaseUrl}"
                                    contentSection="#{CmsRelatedInfoStep.sectionName}"
                                    formParamName="assetIdentifier"
                                    />
                            </div>
                        </div>
                        <ul class="cms-attachments mt-3 list-group"
                            data-list-uuid="#{list.uuid}">
                            <c:forEach items="#{list.attachments}"
                                       var="attachment">
                                <li class="cms-attachment list-group-item mb-3 d-flex justify-content-between"
                                    data-id="#{attachment.uuid}">
                                    <div>
                                        <c:choose>
                                            <c:when test="#{attachment.assetType.equals(CmsRelatedInfoStep.relatedLinkType)}">
                                                <bootstrap:svgIcon icon="bookmark" />
                                                <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.attachment.type.link']}</span>

                                            </c:when>
                                            <c:when test="#{attachment.assetType.equals(CmsRelatedInfoStep.fileAssetType)}">
                                                <bootstrap:svgIcon icon="file-earmark" />
                                                <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.attachment.type.file']}</span>
                                            </c:when>
                                        </c:choose>
                                        <span class="cms-attachment-label">#{attachment.title}</span>
                                    </div>
                                    <div class="cms-attachment-buttons d-flex">
                                        <button class="btn btn-secondary cms-sort-handle mr-2"
                                                type="button">
                                            <bootstrap:svgIcon icon="arrows-move" />
                                            <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.move.button']}"</span>
                                        </button>
                                        <button class="btn btn-secondary mx-2"
                                                data-toggle="modal"
                                                data-target="#attachment-#{attachment.uuid}-info-dialog"
                                                type="button">
                                            <bootstrap:svgIcon icon="info-circle" />
                                            <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.info.button']}"</span>
                                        </button>
                                        <div aria-hidden="true" 
                                             aria-labelledby="attachment-#{attachment.uuid}-info-dialog-title"
                                             class="modal fade"
                                             id="attachment-#{attachment.uuid}-info-dialog"
                                             tabindex="-1"
                                             >
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h3 class="modal-title"
                                                            id="attachment-#{attachment.uuid}-info-dialog-title">
                                                            #{CmsDefaultStepsMessageBundle.getMessage('relatedinfo.attachments.info.dialog.title', [list.name, attachment.title])}

                                                        </h3>
                                                        <button 
                                                            aria-label="#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.info.dialog.close']}"
                                                            class="close"
                                                            data-dismiss="modal"
                                                            type="button">
                                                            <bootstrap:svgIcon icon="x" />
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <dl>
                                                            <dt>#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.info.dialog.title.label']}</dt>
                                                            <dd>#{attachment.title}</dd>
                                                            <dt>#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.info.dialog.type.label']}</dt>
                                                            <dd>#{attachment.assetTypeLabel}</dd>
                                                        </dl>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button class="btn btn-secondary"
                                                                data-dismiss="modal"
                                                                type="button">
                                                            #{CmsDefaultStepsMessageBundle['relatedinfo.attachments.info.dialog.close']}
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <c:if test="#{attachment.assetType.equals(CmsRelatedInfoStep.relatedLinkType)}">
                                            <a class="btn btn-primary mx-2"
                                               href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/#{list.name}/links/#{attachment.assetUuid}/@details"
                                               type="button">
                                                <bootstrap:svgIcon icon="pen" />
                                                <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachments.edit.button']}"</span>
                                            </a>
                                        </c:if>
                                        <libreccm:deleteDialog
                                            actionTarget="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo/attachmentlists/#{list.name}/attachments/#{attachment.uuid}/@remove"
                                            buttonLabelClass="sr-only"
                                            buttonText="#{CmsDefaultStepsMessageBundle['relatedinfo.attachment.remove.label']}"
                                            buttonTextClass="ml-2"
                                            cancelLabel="#{CmsDefaultStepsMessageBundle['relatedinfo.attachment.remove.cancel']}"
                                            confirmLabel="#{CmsDefaultStepsMessageBundle['relatedinfo.attachment.remove.confirm']}"
                                            dialogId="attachment-delete-#{attachment.uuid}"
                                            dialogTitle="#{CmsDefaultStepsMessageBundle['relatedinfo.attachment.remove.title']}"
                                            message="#{CmsDefaultStepsMessageBundle.getMessage('relatedinfo.attachment.remove.message', [list.name, attachment.title])}"
                                            />
                                    </div>
                                </li>
                            </c:forEach>
                        </ul>
                    </li>
                </c:forEach>
            </ul>

            <div>
                <button class="btn btn-secondary attachments-save-order-button"
                        disabled="disabled"
                        type="button">
                    <span class="save-icon">
                        <bootstrap:svgIcon icon="save" />
                    </span>
                    <span class="save-spinner d-none">
                        <span aria-hidden="true"
                              class="spinner-border spinner-border-sm"
                              role="status"></span>
                        <span class="sr-only">#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.order.save.inprogress']}</span>
                    </span>
                    <span>#{CmsDefaultStepsMessageBundle['relatedinfo.attachmentlists.order.save']}</span>
                </button>
            </div>

        </ui:define>

    </ui:composition>
</html>
