<!DOCTYPE html [<!ENTITY times '&#215;'>]>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:composition template="/WEB-INF/views/org/librecms/ui/contentsection/contentsection.xhtml">

        <ui:define name="main">

            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link #{activeDocumentTab == 'editTab' ? 'active' : ''}"
                       href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}">
                        #{CmsAdminMessages['contentsection.document.tabs.edit.title']}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link #{activeDocumentTab == 'history' ? 'active' : ''}"
                       href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@history">
                        #{CmsAdminMessages['contentsection.document.tabs.history.title']}
                    </a>
                </li>
            </ul>

            <div class="row p-3">
                <div class="col-sm-3">
                    <!-- Workflow widget -->
                    <h2>#{CmsAdminMessages['contentsection.document.authoring.workflow.title']}</h2>
                    <p>
                        #{CmsAdminMessages['contentsection.document.authoring.workflow.active_workflow_label']}: 
                        #{CmsSelectedDocumentModel.workflowName}
                        <button class="btn btn-secondary btn-sm"
                                disabled="#{!CmsSelectedDocumentModel.canChangeWorkflow ? 'disabled': ''}"
                                type="button">
                            #{CmsAdminMessages['contentsection.document.authoring.workflow.change_workflow']} 
                        </button>
                    </p>
                    <p>
                        <c:choose>
                            <c:when test="#{CmsSelectedDocumentModel.currentTask != null}">
                                #{CmsAdminMessages['contentsection.document.authoring.workflow.active_task']}
                                #{CmsSelectedDocumentModel.currentTask.label}
                            </c:when>
                            <c:otherwise>
                                #{CmsAdminMessages['contentsection.document.authoring.workflow.active_task.none']}
                                <form action="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@workflow/@start"
                                      method="post">
                                    <input name="returnUrl"
                                           type="hidden"
                                           value="#{stepPath}" />

                                    <button class="btn btn-primary" 
                                            type="submit">
                                        #{CmsAdminMessages['contentsection.document.authoring.workflow.start']}
                                    </button>
                                </form>
                            </c:otherwise>
                        </c:choose>
                        <c:if test="#{CmsSelectedDocumentModel.currentTask != null}">
                            <c:choose>
                                <c:when test="#{(CmsSelectedDocumentModel.currentTask.assignedToCurrentUser or CmsSelectedDocumentModel.currentTask.lockedByCurrentUser)and CmsSelectedDocumentModel.currentTask.locked}">
                                    <div class="d-flex">
                                        <form action="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@workflow/tasks/UUID-#{CmsSelectedDocumentModel.currentTask.taskUuid}/@unlock"
                                              class="mr-2"
                                              method="post">
                                            <input name="returnUrl"
                                                   type="hidden"
                                                   value="#{stepPath}" />
                                            <button class="btn btn-secondary btn-sm" 
                                                    type="submit">
                                                #{CmsAdminMessages['contentsection.document.authoring.workflow.active_task.release']}
                                            </button>
                                        </form>
                                        <form action="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@workflow/tasks/UUID-#{CmsSelectedDocumentModel.currentTask.taskUuid}/@finish"
                                              class="ml-2"
                                              method="post">
                                            <input name="returnUrl"
                                                   type="hidden"
                                                   value="#{stepPath}" />
                                            <button class="btn btn-secondary btn-sm" 
                                                    type="submit">
                                                #{CmsAdminMessages['contentsection.document.authoring.workflow.active_task.finish']}
                                            </button>
                                        </form>
                                    </div>
                                </c:when>
                                <c:when test="#{CmsSelectedDocumentModel.currentTask.locked and CmsSelectedDocumentModel.canChangeWorkflow}">
                                    <form action="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@workflow/tasks/UUID-#{CmsSelectedDocumentModel.currentTask.taskUuid}/@lock"
                                          method="post">
                                        <input name="returnUrl"
                                               type="hidden"
                                               value="#{stepPath}" />
                                        <button class="btn btn-secondary btn-sm"
                                                type="submit">
                                            #{CmsAdminMessages['contentsection.document.authoring.workflow.active_task.takeover']}
                                        </button>
                                    </form>

                                </c:when>
                                <c:when test="#{CmsSelectedDocumentModel.currentTask.assignedToCurrentUser or CmsSelectedDocumentModel.canChangeWorkflow}">
                                    <form action="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@workflow/tasks/UUID-#{CmsSelectedDocumentModel.currentTask.taskUuid}/@lock"
                                          method="post">
                                        <input name="returnUrl"
                                               type="hidden"
                                               value="#{stepPath}" />
                                        <button class="btn btn-secondary btn-sm" 
                                                type="submit">
                                            #{CmsAdminMessages['contentsection.document.authoring.workflow.active_task.lock']}
                                        </button>
                                    </form>
                                </c:when>
                            </c:choose>
                        </c:if>
                    </p>

                    <!-- Authoring steps -->
                    <h2>#{CmsAdminMessages['contentsection.document.authoring.steps.title']}</h2>
                    <ul class="list-group">
                        <c:forEach items="#{CmsSelectedDocumentModel.authoringStepsList}"
                                   var="step">
                            <li aria-current="#{step.path == authoringStep ? 'true' : ''}"
                                class="list-group-item #{step.path == authoringStep ? 'active' : ''}">
                                <a class="list-group-item-action"
                                   href="#{step.path}">
                                    #{step.label}
                                </a>
                            </li>
                        </c:forEach>

                        <c:if test="#{!CmsSelectedDocumentModel.excludeDefaultAuthoringSteps}">
                            <li aria-current="#{'categorize' == authoringStep ? 'true' : ''}"
                                class="list-group-item #{'categorize' == authoringStep ? 'active' : ''}">
                                <a class="list-group-item-action"
                                   href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@categorization">
                                    #{CmsAdminMessages['contentsection.document.authoring.steps.categorize.label']}
                                </a>
                            </li>
                            <li aria-current="#{'relatedInfo' == authoringStep ? 'true' : ''}"
                                class="list-group-item #{'relatedInfo' == authoringStep ? 'active' : ''}">
                                <a class="list-group-item-action"
                                   href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@relatedinfo">
                                    #{CmsAdminMessages['contentsection.document.authoring.steps.relatedInfo.label']}
                                </a>
                            </li>
                        </c:if>

                        <li aria-current="#{'publish' == authoringStep ? 'true' : ''}"
                            class="list-group-item #{'publish' == authoringStep ? 'active' : ''}">
                            <a class="list-group-item-action"
                               href="#{mvc.basePath}/#{ContentSectionModel.sectionName}/documents/#{CmsSelectedDocumentModel.itemPath}/@publish">
                                #{CmsAdminMessages['contentsection.document.authoring.steps.publish.label']}
                            </a>
                        </li>

                    </ul>

                </div>

                <div class="col-sm-9">

                    <c:forEach items="#{CmsMessages.messages.entrySet}"
                               var="message">
                        <div class="alert alert-#{message.key}" role="alert">
                            #{message.value}
                        </div>
                    </c:forEach>

                    <ui:insert name="authoringStep" />
                </div>
            </div>
        </ui:define>

    </ui:composition>
</html>
